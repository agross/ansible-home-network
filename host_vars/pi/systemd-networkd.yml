systemd_networkd_enable_resolved: true
systemd_networkd_symlink_resolv_conf: true
systemd_networkd_apply_config: true

systemd_networkd_network:
  eth0:
    - Match:
        - Name: "{{ interfaces.lan.device }}"
    - Network:
        - DHCP: false
        - Address: >-
            {{
              (interfaces.lan.ip4.address ~ '/' ~ interfaces.lan.ip4.prefix) |
              ansible.utils.ipaddr('host/prefix')
            }}
        - Address: >-
            {{
              (interfaces.lan.ip6.address ~ '/' ~ interfaces.lan.ip6.prefix) |
              ansible.utils.ipaddr('host/prefix')
            }}
        - DNS: "{{ interfaces.lan.ip4.dns }}"
        - DNS: "{{ interfaces.lan.ip6.dns }}"
        - DNSDefaultRoute: true
        - Domains: "{{ dns.search_domains | join(' ') }}"
        - MulticastDNS: true

        - IPv6LinkLocalAddressGenerationMode: stable-privacy

    - Route:
        - Gateway: "{{ network_gateway.ip4 }}"
        - GatewayOnLink: true
