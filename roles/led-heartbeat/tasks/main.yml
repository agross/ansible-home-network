- name: Load ledtrig_heartbeat kernel module
  community.general.modprobe:
    name: ledtrig_heartbeat
    state: present
  # Fails when the kernel was updated during the same playbook run.
  failed_when: false

- name: Copy systemd service unit
  ansible.builtin.template:
    src: led-heartbeat.service
    dest: /etc/systemd/system/{{ service_name }}.service
    owner: 0
    group: 0
    mode: '644'
  notify: Restart led-heartbeat service

- name: Start service
  ansible.builtin.systemd:
    state: started
    enabled: true
    name: "{{ service_name }}"
    daemon_reload: true
