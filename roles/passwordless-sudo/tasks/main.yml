- ansible.builtin.import_tasks: login-user.yml

- name: Ensure group {{ group }} exists
  ansible.builtin.group:
    name: ansible
    state: present

- name: Add user {{ login_user }} to group {{ group }}
  ansible.builtin.user:
    name: "{{ login_user }}"
    groups: "{{ group }}"
    append: yes

- name: Enable passwordless sudo for group {{ group }}
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    state: present
    regexp: "^%{{ group }}"
    line: "%{{ group }} ALL = (ALL) NOPASSWD: ALL"
    validate: 'visudo -cf %s'
