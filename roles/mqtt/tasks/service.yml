- name: Copy conf directory
  template:
    src: "{{ item }}"
    dest: "{{ conf_dir }}/{{ item | basename | regex_replace('\\.j2$', '') }}"
  with_fileglob:
    ../templates/conf/*
  notify: Restart service

- name: Copy environment file
  template:
    src: ../templates/.env.j2
    dest: "{{ root }}/.env"
  notify: Restart service

- name: Copy systemd unit file
  template:
    src: ../templates/systemd.service.j2
    dest: /etc/systemd/system/{{ service_name }}.service
  notify: Restart service

- name: Set permissions on data directory
  file:
    dest: "{{ data_dir }}"
    owner: '1883'
    recurse: true

- name: Start service
  systemd:
    state: started
    enabled: true
    name: "{{ service_name }}"
    daemon_reload: true
