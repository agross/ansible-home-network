- name: Install required packages
  ansible.builtin.apt:
    name: >-
      {{
        [
          'build-essential',
          'bison',
          'flex',
          'libssl-dev'
        ] + (ccu_required_packages | default([]))
      }}
    state: present

- name: Add repository
  ansible.builtin.deb822_repository:
    name: pivccu
    types: deb
    uris:
      - https://www.pivccu.de/piVCCU/
    signed_by: https://www.pivccu.de/piVCCU/public.key
    suites:
      - stable
    components:
      - main
    state: present

- name: Install kernel modules
  ansible.builtin.apt:
    name:
      - pivccu-modules-dkms
    state: present
  notify: Reboot
