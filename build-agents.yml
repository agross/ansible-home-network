- name: Install TeamCity build agent
  hosts: build_agents
  become: true
  roles:
    - name: build-agent
      tags: build-agent
    - name: docker
      tags: docker
      vars:
        docker_users:
          - "{{ ansible_env.SUDO_USER | default(ansible_user_id) }}"
          - build-agent
    - name: devsec.hardening.ssh_hardening
      vars:
        network_ipv6_enable: true
        ssh_listen_to:
          - '0.0.0.0'
          - '::'
        ssh_allow_tcp_forwarding: 'yes'
        ssh_allow_agent_forwarding: true
        sftp_enabled: true
      tags: ssh
    - name: exploide.dnf-automatic
      vars:
        dnf_automatic_upgrade_type: default
        dnf_automatic_emit_via: stdio, email
        dnf_automatic_email_to: "{{ dnf_automatic_recipient | default('root') }}"
      tags: dnf-automatic
