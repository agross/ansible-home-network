- name: Proxmox configuration
  hosts: ogd:&hypervisor
  become: true
  gather_facts: false
  pre_tasks:
    - name: End play for hypervisors that are detected falsely
      ansible.builtin.meta: end_host
      when: hypervisor is not defined
  roles:
    - name: lae.proxmox
      vars:
        # Would remove Proxmox completely.
        # https://github.com/lae/ansible-role-proxmox/issues/223
        pve_remove_old_kernels: false
      tags: proxmox
    - name: proxmox
      tags: proxmox
    - name: smartmontools
      tags: smartmontools

- name: Import Linux configuration playbook
  ansible.builtin.import_playbook: _linux.yml
  vars:
    playbook_hosts: ogd:&linux

- name: Import Fedora configuration playbook
  ansible.builtin.import_playbook: _fedora.yml
  vars:
    playbook_hosts: ogd:&fedora

- name: Import gateway configuration playbook
  ansible.builtin.import_playbook: _gateway.yml
  vars:
    playbook_hosts: gateway-ogd

- name: Hosted services
  hosts: finn
  become: true
  roles:
    - name: docker
      tags: docker
    - name: dns-server
      tags:
        - dns-server
        - container
#     - name: mqtt
#       tags:
#         - mqtt
#         - container
#     - name: iobroker
#       tags:
#         - iobroker
#         - container
#     - name: logger
#       tags:
#         - logger
#         - container
#     - name: traefik
#       tags:
#         - traefik
#         - container
#     - name: vscode-remote-ssh
#       tags: vscode-remote-ssh
#     - name: vladgh.samba.server
#       vars:
#         samba_shares_root: /tmp/unused
#         samba_shares:
#           - name: Time Machine
#             comment: Time Machine Backups
#             path: /time-machine
#             write_list: agross
#             include_file: samba-share-timemachine.conf

#         samba_users: "{{ vault_samba_users }}"

#         # See "templates" directory.
#         samba_global_include: samba-global.conf
#         samba_homes_include: samba-homes.conf

#         samba_load_homes: true
#         samba_wins_support: false
#         # Bullseye has 4.13.13, fix is required up to 4.6.4 as per docs, but
#         # the version comparison fails for some reason.
#         samba_mitigate_cve_2017_7494: false
#       tags: samba
