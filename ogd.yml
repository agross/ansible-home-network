- name: Proxmox configuration
  hosts: ogd:&hypervisor
  become: true
  gather_facts: false
  pre_tasks:
    - name: End play for hypervisors that are detected falsely
      ansible.builtin.meta: end_host
      when: hypervisor is not defined
  roles:
    - name: lae.proxmox
      vars:
        # Would remove Proxmox completely.
        # https://github.com/lae/ansible-role-proxmox/issues/223
        pve_remove_old_kernels: false
      tags: proxmox
    - name: proxmox
      tags: proxmox
    - name: smartmontools
      tags: smartmontools

- name: Import Linux configuration playbook
  tags: linux
  ansible.builtin.import_playbook: _linux.yml
  vars:
    playbook_hosts: ogd:&linux

- name: Import Fedora configuration playbook
  tags: fedora
  ansible.builtin.import_playbook: _fedora.yml
  vars:
    playbook_hosts: ogd:&fedora

- name: Gateway configuration
  hosts: gateway-ogd
  become: true
  gather_facts: false
  roles:
    - name: gateway
      tags: gateway

- name: Hosted services
  hosts: finn
  become: true
  gather_facts: false
  roles:
    - name: docker
      tags: docker
    - name: dns-server
      tags:
        - dns-server
        - container
    - name: mqtt
      tags:
        - mqtt
        - container
    - name: traefik
      tags:
        - traefik
        - container
    - name: iobroker
      tags:
        - iobroker
        - container
    - name: logger
      tags:
        - logger
        - container
    - name: samba
      tags: samba
