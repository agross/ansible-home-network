- name: Generate htpasswd
  ansible.builtin.set_fact:
    "{{ fact }}": >-
      {%- set output = [] -%}
      {%- set salty = salt | mandatory -%}
      {%- for user, passwd in users.items() -%}
        {{ output.append(user ~ ':' ~ passwd | password_hash('bcrypt', rounds = 5, salt = salty) ) }}
      {%- endfor -%}
      {{ output | join(',') }}
