- name: Linux configuration
  hosts: "{{ playbook_hosts | mandatory }}"
  become: true
  gather_facts: false
  roles:
    - role: guest-agent
      tags: guest-agent
    - role: watchdog
      when: >-
        ansible_virtualization_role == 'guest' or
        "'raspi' in group_names"
      tags: watchdog
    - role: kernel-cmdline
      tags: kernel-cmdline
    - role: fstrim
      tags: fstrim
    - role: filesystem
      tags: filesystem
    - role: devsec.hardening.ssh_hardening
      tags: ssh
    - role: networking
      when: systemd_networkd_network is defined
      tags: [network, networking]
    - role: postfix
      when: google_smtp_password is defined
      tags: postfix
    - role: unit-status-mail
      when: google_smtp_password is defined
      tags: unit-status-mail
    - role: borgmatic
      when: borgmatic_encryption_passphrase is defined
      tags: borgmatic
    - role: netdata
      tags: netdata
    - role: dotfiles
      tags: dotfiles
